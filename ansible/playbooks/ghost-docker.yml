---

- name: Create compose directory
  become: true
  file:
    state: directory
    path: /docker/compose/ghost/

- name: Template compose file
  become: true
  template:
    src: templates/ghost/docker-compose.yml
    dest: /docker/compose/ghost/docker-compose.yml

- name: Template nginx config file
  become: true
  template:
    src: templates/ghost/nginx.conf
    dest: "{{ nginx_config_dir }}/{{ ghost_server_name }}.conf"

- name: Stop service
  become: true
  command: docker-compose -f /docker/compose/ghost/docker-compose.yml down

- name: Start service
  become: true
  command: docker-compose -f /docker/compose/ghost/docker-compose.yml up -d

- name: Reload nginx
  become: true
  command: docker-compose -f /docker/compose/nginx/docker-compose.yml exec nginx nginx -s reload
